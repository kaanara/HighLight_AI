<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Highlight AI Settings</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      font-weight: 600;
      font-size: 18px;
    }

    .content {
      padding: 24px;
    }

    .section {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: #333;
      margin-bottom: 6px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }

    .help-text {
      font-size: 11px;
      color: #999;
      margin-top: 4px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 24px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      flex: 1;
    }

    .btn-primary:hover {
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .lm-studio-section {
      border-top: 1px solid #eee;
      padding-top: 24px;
      margin-top: 24px;
    }

    .lm-studio-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .btn-lm {
      background: #4CAF50;
      color: white;
    }

    .btn-lm:hover {
      background: #45a049;
    }

    .status-message {
      padding: 10px;
      border-radius: 6px;
      font-size: 12px;
      margin-top: 10px;
      display: none;
    }

    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }

    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }

    .status-message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      Highlight AI Settings
    </div>
    
    <div class="content">
      <div class="section">
        <div class="section-title">AI Configuration</div>
        
        <div class="form-group">
          <label for="baseURL">API Base URL</label>
          <input type="text" id="baseURL" placeholder="http://localhost:1234/v1" />
          <div class="help-text">The base URL for your LM Studio or OpenAI-compatible API</div>
        </div>

        <div class="form-group">
          <label for="modelName">Model Name</label>
          <input type="text" id="modelName" placeholder="qwen/qwen3-4b-2507" />
          <div class="help-text">The exact model name as shown in LM Studio</div>
        </div>

        <div class="button-group">
          <button class="btn-primary" onclick="saveConfig()">Save Configuration</button>
          <button class="btn-secondary" onclick="resetToDefaults()">Reset to Defaults</button>
        </div>

        <div id="configStatus" class="status-message"></div>
      </div>

      <div class="section lm-studio-section">
        <div class="section-title">LM Studio Setup</div>
        <div class="help-text" style="margin-bottom: 12px;">
          Install LM Studio CLI and download models directly from this app.
        </div>
        
        <div class="lm-studio-actions">
          <button class="btn-lm" onclick="installLMStudio(event)">Install LM Studio CLI</button>
          <button class="btn-lm" onclick="downloadModel(event)">Download Model (qwen/qwen3-4b-2507)</button>
          <button class="btn-lm" onclick="openLMStudio()">Open LM Studio</button>
        </div>

        <div id="lmStatus" class="status-message"></div>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    // Load config when window opens
    window.addEventListener('DOMContentLoaded', () => {
      loadConfig();
    });

    async function loadConfig() {
      try {
        const config = await ipcRenderer.invoke('get-config');
        document.getElementById('baseURL').value = config.baseURL || '';
        document.getElementById('modelName').value = config.modelName || '';
      } catch (error) {
        showStatus('configStatus', 'Error loading configuration', 'error');
      }
    }

    async function resetToDefaults() {
      try {
        // Reset to hardcoded default values
        const defaultConfig = {
          baseURL: 'http://localhost:1234/v1',
          modelName: 'qwen/qwen3-4b-2507'
        };
        
        // Update UI fields
        document.getElementById('baseURL').value = defaultConfig.baseURL;
        document.getElementById('modelName').value = defaultConfig.modelName;
        
        // Save defaults to disk
        await ipcRenderer.invoke('save-config', defaultConfig);
        
        // Reload LM client with default config
        await ipcRenderer.invoke('reload-lm-client');
        
        showStatus('configStatus', 'Configuration reset to defaults successfully!', 'success');
      } catch (error) {
        showStatus('configStatus', `Error resetting to defaults: ${error.message}`, 'error');
      }
    }

    async function saveConfig() {
      const baseURL = document.getElementById('baseURL').value.trim();
      const modelName = document.getElementById('modelName').value.trim();

      if (!baseURL || !modelName) {
        showStatus('configStatus', 'Please fill in all fields', 'error');
        return;
      }

      try {
        await ipcRenderer.invoke('save-config', { baseURL, modelName });
        showStatus('configStatus', 'Configuration saved successfully!', 'success');
        
        // Reload LM client with new config
        await ipcRenderer.invoke('reload-lm-client');
      } catch (error) {
        showStatus('configStatus', `Error saving configuration: ${error.message}`, 'error');
      }
    }

    async function installLMStudio(event) {
      const btn = (event && event.target) ? event.target : 
        Array.from(document.querySelectorAll('.btn-lm')).find(b => b.textContent.includes('Install LM Studio CLI'));
      if (!btn) return;
      
      btn.classList.add('loading');
      btn.textContent = 'Installing...';
      
      try {
        showStatus('lmStatus', 'Installing LM Studio CLI... This may take a few minutes.', 'info');
        const result = await ipcRenderer.invoke('install-lmstudio');
        
        if (result.success) {
          showStatus('lmStatus', 'LM Studio CLI installed successfully!', 'success');
        } else {
          showStatus('lmStatus', `Installation failed: ${result.error}`, 'error');
        }
      } catch (error) {
        showStatus('lmStatus', `Error: ${error.message}`, 'error');
      } finally {
        btn.classList.remove('loading');
        btn.textContent = 'Install LM Studio CLI';
      }
    }

    async function downloadModel(event) {
      const btn = (event && event.target) ? event.target : 
        Array.from(document.querySelectorAll('.btn-lm')).find(b => b.textContent.includes('Download Model'));
      if (!btn) return;
      
      btn.classList.add('loading');
      btn.textContent = 'Downloading...';
      
      try {
        showStatus('lmStatus', 'Downloading model qwen/qwen3-4b-2507... This may take several minutes.', 'info');
        const result = await ipcRenderer.invoke('download-model', 'qwen/qwen3-4b-2507');
        
        if (result.success) {
          showStatus('lmStatus', 'Model downloaded successfully!', 'success');
        } else {
          showStatus('lmStatus', `Download failed: ${result.error}`, 'error');
        }
      } catch (error) {
        showStatus('lmStatus', `Error: ${error.message}`, 'error');
      } finally {
        btn.classList.remove('loading');
        btn.textContent = 'Download Model (qwen/qwen3-4b-2507)';
      }
    }

    async function openLMStudio() {
      try {
        const result = await ipcRenderer.invoke('open-lmstudio');
        if (result.success) {
          showStatus('lmStatus', 'LM Studio opened successfully!', 'success');
        } else {
          showStatus('lmStatus', `Failed to open LM Studio: ${result.error}`, 'error');
        }
      } catch (error) {
        showStatus('lmStatus', `Error: ${error.message}`, 'error');
      }
    }

    function showStatus(elementId, message, type) {
      const statusEl = document.getElementById(elementId);
      statusEl.textContent = message;
      statusEl.className = `status-message ${type}`;
      
      // Auto-hide success messages after 5 seconds
      if (type === 'success') {
        setTimeout(() => {
          statusEl.className = 'status-message';
        }, 5000);
      }
    }
  </script>
</body>
</html>

